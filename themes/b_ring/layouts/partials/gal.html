{{ if isset .Params "gal" }}
  {{ $gallery := .Params.gal }}
  {{ $imageMetaData := .Params.photos }}
  {{ $dir := (printf "static/photos/%s/" $gallery) }}

  <div class="gallery-container">

    {{ range $m := $imageMetaData }}
      {{ $imageName := index $m "name" }}
      {{ $alt := index $m "alt" }}
      {{ $short := index $m "short" }}
      {{ $path := (printf "/photos/%s/%s" $gallery $imageName) }}
      {{ $margin := index $m "margin" }}
      {{ $thumbPathMd := (printf "/photos/%s/thumb_md-%s" $gallery $imageName) }}
      {{ $thumbPathSm := (printf "/photos/%s/thumb_sm-%s" $gallery $imageName) }}

      <div class="gallery-image">

        {{ if (where (readDir $dir) "Name" $imageName) }}
          <a data-title="{{ $alt }}" href="{{ $.Site.BaseURL }}{{ $path }}" data-lightbox="lightbox-{{ $gallery }}">
            <img alt="{{ $alt }}"

              {{ if $margin }}
                style="

                  {{ if index $margin "top" }}
                    margin-top: {{ index $margin "top" }}px;
                  {{ end }}

                  {{ if index $margin "bottom" }}
                    margin-bottom: {{ index $margin "bottom" }}px;
                  {{ end }}

                  {{ if index $margin "left" }}
                    margin-left: {{ index $margin "left" }}px;
                  {{ end }}

                  {{ if index $margin "right" }}
                    margin-right: {{ index $margin "right" }}px;
                  {{ end }}

                      "
              {{ end }}

              {{ if (index $m "featured") }}
                src="{{ $.Site.BaseURL }}{{ $thumbPathMd }}"
              {{ else }}
                src="{{ $.Site.BaseURL }}{{ $thumbPathSm }}"
              {{ end }}

              />
          </a>
          <p>{{ $short }}</p>

        {{ else }}
          <p>{{ substr $path 1 }} does not exist</p>
        {{ end }}

      </div>

    {{ end }}

    <p class="description">{{ .Params.description }}</p>
  </div>

{{ end }}
