{{ $permaLink := substr (relURL .Permalink) 0 -1 }}

<div class="gallery-item">

  {{ range $m := first 1 (where .Params.photos "featured" "true") }}
    {{ $imageName := index $m "photo" }}
    {{ $splitted := (split $imageName "/") }}
    {{ $img := index $splitted (sub (len $splitted) 1) }}
    {{ $alt := index $m "alt" }}
    {{ $size := or (index $m "size") "md" }}
    {{ $margin := index $m "margin" }}
    {{ $thumbPath := (printf "/photos/gal/thumb_%s-%s" $size $img) }}
    <div class="gallery-image">

        <a href="{{ $permaLink }}">

          <img class="lazy" alt="{{ $alt }}"
            {{ if $margin }}
              style="

                {{ if index $margin "top" }}
                  margin-top: {{ index $margin "top" }}px;
                {{ end }}

                {{ if index $margin "bottom" }}
                  margin-bottom: {{ index $margin "bottom" }}px;
                {{ end }}

                {{ if index $margin "left" }}
                  margin-left: {{ index $margin "left" }}px;
                {{ end }}

                {{ if index $margin "right" }}
                  margin-right: {{ index $margin "right" }}px;
                {{ end }}

                    "
            {{ end }}
              data-original="{{ $thumbPath }}"/>
        </a>
        
    </div>
  {{ end }}
</div>
